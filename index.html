<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸¸ë“œì „ í†µí•© ì‹œìŠ¤í…œ</title>
    <style>
        body { background-color: #121212; color: #e0e0e0; font-family: 'Segoe UI', sans-serif; text-align: center; padding-bottom: 50px;}
        .container { max-width: 420px; margin: 0 auto; padding: 15px; }

        /* ë„¤ì˜¨ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .box {
            background: #1e1e1e; border: 1px solid #333; border-radius: 12px;
            padding: 20px; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        .neon-blue { border-left: 5px solid #00ffff; }
        .neon-green { border-left: 5px solid #00ff00; }
        .neon-red { border-left: 5px solid #ff4444; }
        .neon-purple { border-left: 5px solid #d500f9; }

        h3 { margin-top: 0; color: #fff; }

        /* ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ */
        input, select, textarea {
            width: 90%; padding: 12px; margin: 8px 0;
            background: #2c2c2c; border: 1px solid #444; color: white; border-radius: 5px;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        button {
            width: 100%; padding: 12px; margin-top: 5px;
            background: #333; color: white; border: none; border-radius: 5px;
            font-weight: bold; cursor: pointer; transition: 0.3s;
        }
        button:hover { background: #555; }
        .btn-small { width: auto; padding: 8px 15px; font-size: 0.9em; margin: 5px; }

        .hidden { display: none; }
        .loading { color: #888; font-size: 0.9em; }
    </style>
</head>
<body>

<div class="container">
    <h2>âš”ï¸ ê¸¸ë“œì „ ì‘ì „ìƒí™©ì‹¤</h2>

    <div id="loginArea" class="box neon-blue">
        <h3>ğŸ” ë¡œê·¸ì¸</h3>
        <input type="text" id="myNick" placeholder="ë‹‰ë„¤ì„">
        <button onclick="login()">ì ‘ì†í•˜ê¸°</button>
    </div>

    <div id="mainArea" class="hidden">

        <div class="box neon-green">
            <h3>ğŸ¯ íƒ€ê²Ÿ ì„¤ì •</h3>
            <p id="loadingMsg" class="loading">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            <select id="enemySelect" onchange="showStrategy()">
                <option value="">-- ìƒëŒ€ë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>
            </select>
            <div id="enemyDeckInfo" style="color:#aaa; font-size:0.9em; margin-top:5px;"></div>
        </div>

        <div id="strategyBox" class="box" style="border-left: 5px solid gold;">
            <h3>ğŸ’¡ ì¶”ì²œ ê³µëµ</h3>
            <div id="strategyDisplay" style="text-align: left; padding: 10px; background:#252525; border-radius:5px;">
                íƒ€ê²Ÿì„ ì„ íƒí•˜ë©´ ê³µëµì´ í‘œì‹œë©ë‹ˆë‹¤.
            </div>
        </div>

        <div class="box neon-red">
            <h3>ğŸ“ ê²°ê³¼ ë³´ê³ </h3>
            <button onclick="record('WIN')" style="background:#2e7d32;">â­â­â­ ì™„íŒŒ (ìŠ¹ë¦¬)</button>
            <button onclick="record('LOSE')" style="background:#c62828;">âŒ ì‹¤íŒ¨ (íŒ¨ë°°)</button>
        </div>

        <hr style="border-color:#333; margin: 30px 0;">

        <button onclick="toggleAdmin()" style="background:#444;">ğŸ› ï¸ ì „ëµê°€ ëª¨ë“œ (ë± ì¶”ê°€/ê³µëµ ì‘ì„±)</button>

        <div id="adminArea" class="hidden" style="margin-top:20px;">

            <div class="box neon-purple">
                <h3>ğŸ‘¾ ì‹ ê·œ ì êµ° ë“±ë¡</h3>
                <input type="text" id="newEnemyName" placeholder="ì  ë‹‰ë„¤ì„ (ì˜ˆ: ë­ì»¤1)">
                <input type="text" id="newEnemyDeck" placeholder="ë°©ì–´ë± (ì˜ˆ: ì—ë°˜/ì œì´ë¸Œ/ìŠ¤íŒŒ)">
                <button onclick="addNewEnemy()">ì êµ° ë“±ë¡</button>
            </div>

            <div class="box neon-purple">
                <h3>ğŸ“œ ê³µëµë²• ì¶”ê°€</h3>
                <select id="targetEnemySelect">
                    <option value="">-- ê³µëµí•  ëŒ€ìƒ ì„ íƒ --</option>
                </select>
                <input type="text" id="newAttackDeck" placeholder="ì¶”ì²œ ê³µê²©ë± (ì˜ˆ: ë¦° ë§ˆê³µë±)">
                <textarea id="newStrategyNote" placeholder="ìƒì„¸ ê³µëµ (í«, ì§„í˜•, ì£¼ì˜ì‚¬í•­ ë“±)"></textarea>
                <button onclick="addStrategy()">ê³µëµ ë“±ë¡</button>
            </div>
        </div>

    </div>
</div>

<script>
    // ë°°í¬í•œ Apps Script URLì„ ì—¬ê¸°ì— ë„£ìœ¼ì„¸ìš”!
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxz_Y0rXv7uAJ1cdoxyn_pka8lFyee-VqhQbxUlx2WxGc_2i_OcxWBtLQdAY4iYBbP0/exec";

    let currentUser = "";
    let globalData = { enemies: [], strategies: [] }; // ë°ì´í„°ë¥¼ ë‹´ì•„ë‘˜ ì „ì—­ ë³€ìˆ˜

    function login() {
        const nick = document.getElementById('myNick').value;
        if (!nick) return alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”.");

        currentUser = nick;
        document.getElementById('loginArea').classList.add('hidden');
        document.getElementById('mainArea').classList.remove('hidden');

        // ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ë°ì´í„° ë¡œë“œ
        loadData();
    }

    // 1. ì´ˆê¸° ë°ì´í„° ë¡œë“œ (GET ìš”ì²­)
    function loadData() {
        fetch(GAS_URL)
            .then(response => response.json())
            .then(data => {
                globalData = data;
                renderDropdowns();
                document.getElementById('loadingMsg').classList.add('hidden');
            })
            .catch(error => alert("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: " + error));
    }

    // 2. ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ê·¸ë¦¬ê¸°
    function renderDropdowns() {
        const select = document.getElementById('enemySelect');
        const adminSelect = document.getElementById('targetEnemySelect');

        // ê¸°ì¡´ ì˜µì…˜ ì´ˆê¸°í™”
        select.innerHTML = '<option value="">-- ìƒëŒ€ë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>';
        adminSelect.innerHTML = '<option value="">-- ê³µëµí•  ëŒ€ìƒ ì„ íƒ --</option>';

        globalData.enemies.forEach(enemy => {
            // ë©”ì¸ í™”ë©´ ì„ íƒì°½
            let option = document.createElement("option");
            option.value = enemy.name;
            option.text = enemy.name;
            select.add(option);

            // ê´€ë¦¬ì í™”ë©´ ì„ íƒì°½
            let adminOption = document.createElement("option");
            adminOption.value = enemy.name;
            adminOption.text = enemy.name;
            adminSelect.add(adminOption);
        });
    }

    // 3. ì„ íƒ ì‹œ ê³µëµ ë³´ì—¬ì£¼ê¸°
    function showStrategy() {
        const selectedName = document.getElementById('enemySelect').value;
        const display = document.getElementById('strategyDisplay');
        const deckInfo = document.getElementById('enemyDeckInfo');

        // 1) ì êµ° ë°©ì–´ë± ì •ë³´ í‘œì‹œ
        const enemyObj = globalData.enemies.find(e => e.name === selectedName);
        if (enemyObj) {
            deckInfo.innerText = "ğŸ›¡ï¸ ë°©ì–´ë±: " + enemyObj.deck;
        } else {
            deckInfo.innerText = "";
            display.innerText = "íƒ€ê²Ÿì„ ì„ íƒí•˜ë©´ ê³µëµì´ í‘œì‹œë©ë‹ˆë‹¤.";
            return;
        }

        // 2) ë§¤ì¹­ë˜ëŠ” ê³µëµ ì°¾ê¸°
        const strategies = globalData.strategies.filter(s => s.target === selectedName);

        if (strategies.length > 0) {
            let html = "";
            strategies.forEach(s => {
                html += `<div style="margin-bottom:10px; border-bottom:1px solid #444; padding-bottom:5px;">
                            <b>âš”ï¸ ì¶”ì²œ: ${s.attack}</b><br>
                            <span style="color:#bbb; font-size:0.9em;">Tip: ${s.note}</span>
                         </div>`;
            });
            display.innerHTML = html;
        } else {
            display.innerHTML = "âŒ ë“±ë¡ëœ ê³µëµì´ ì—†ìŠµë‹ˆë‹¤. ì „ëµê°€ ëª¨ë“œì—ì„œ ì¶”ê°€í•´ì£¼ì„¸ìš”!";
        }
    }

    // 4. ì‹ ê·œ ì êµ° ì¶”ê°€ (POST)
    function addNewEnemy() {
        const name = document.getElementById('newEnemyName').value;
        const deck = document.getElementById('newEnemyDeck').value;

        if(!name || !deck) return alert("ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");

        sendData({
            action: "add_enemy",
            enemyName: name,
            defenseDeck: deck
        }, "ì êµ°ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! (ìƒˆë¡œê³ ì¹¨ ì‹œ ëª©ë¡ ê°±ì‹ )");
    }

    // 5. ê³µëµ ì¶”ê°€ (POST)
    function addStrategy() {
        const target = document.getElementById('targetEnemySelect').value;
        const deck = document.getElementById('newAttackDeck').value;
        const note = document.getElementById('newStrategyNote').value;

        if(!target || !deck) return alert("ëŒ€ìƒê³¼ ê³µê²©ë±ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");

        sendData({
            action: "add_strategy",
            targetEnemy: target,
            attackDeck: deck,
            note: note,
            author: currentUser
        }, "ê³µëµì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!");
    }

    // 6. ê²°ê³¼ ê¸°ë¡ (POST)
    function record(result) {
        const target = document.getElementById('enemySelect').value;
        if(!target) return alert("ëŒ€ìƒì„ ì„ íƒí•˜ì„¸ìš”.");

        sendData({
            action: "record",
            nickname: currentUser,
            enemyName: target,
            result: result
        }, "ì „íˆ¬ ê²°ê³¼ ê¸°ë¡ ì™„ë£Œ!");
    }

    // ë°ì´í„° ì „ì†¡ ê³µí†µ í•¨ìˆ˜
    function sendData(payload, successMsg) {
        fetch(GAS_URL, {
            method: "POST",
            mode: "no-cors",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        }).then(() => {
            alert(successMsg);
            // ì…ë ¥ì°½ ì´ˆê¸°í™”
            if(payload.action === "add_enemy") {
                document.getElementById('newEnemyName').value = "";
                document.getElementById('newEnemyDeck').value = "";
            }
        });
    }

    function toggleAdmin() {
        const el = document.getElementById('adminArea');
        el.classList.toggle('hidden');
    }
</script>

</body>
</html>